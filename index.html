<!doctype html>
<html>
    <head> 
        <meta charset="utf-8" /> 
        <title>Predict Stock Data</title>
        <link href="favicon.ico" rel="icon" type="image/x-icon" />
        <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    
    <!-- Optional theme -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
    
    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    <!--[if lt IE 9]>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.js"></script>
    <![endif]-->
    <link href="css/bootstrap.css" rel="stylesheet">
    </head>
    <style> /* set the CSS */

    body { font: 12px Arial;}
    
    path { 
        stroke: steelblue;
        stroke-width: 2;
        fill: none;
    }
    
    text.shadow {
        stroke: white;
        stroke-width: 2.5px;
        opacity: 0.9;
    }
    
    .axis path,
    .axis line {
        fill: none;
        stroke: grey;
        stroke-width: 1;
        shape-rendering: crispEdges;
    }
    
    </style>
    <body>
    
    
    <!-- set inputs for the query -->    
    <div id="new_input">
        &nbsp &nbsp
        Stock: <input type="text" name="stock" id="stock" value="YHOO" 
        style="width: 70px;">
        &nbsp &nbsp
        Start: <input type="text" name="start" id="start" value="2013-08-10"
        style="width: 80px;">
        &nbsp &nbsp
        End: <input type="text" name="end" id="end" value="2014-03-10" 
        style="width: 80px;">
        &nbsp &nbsp
        <input name="updateButton" 
        type="button" 
        value="Update" 
        onclick="updateData()" />
    </div>
    <div class="row">
        <div class="col-md-6" id="area1"></div>
        <div class="col-md-6" id="area2"></div>
    </div>
    <!-- load the d3.js library -->    
    <script src="https://d3js.org/d3.v3.min.js"></script>
    <script src="/fortunefive.js"></script>
    <script>
    // Set the dimensions of the graph
    var margin = {top: 30, right: 40, bottom: 30, left: 50},
        width = 600 - margin.left - margin.right,
        height = 270 - margin.top - margin.bottom;
    
    // Parse the date / time
    var parseDate = d3.time.format("%Y-%m-%d").parse;
    
    // Set the ranges
    var x = d3.time.scale().range([0, width]);
    var y = d3.scale.linear().range([height, 0]);
    
    var xAxis = d3.svg.axis().scale(x)
        .orient("bottom").ticks(5);
    
    var    yAxis = d3.svg.axis().scale(y)
        .orient("left").ticks(5);
    
    var valueline = d3.svg.line()
        .x(function(d) { return x(d.date); })
        .y(function(d) { return y(d.high); });
        
      
    var svg = d3.select("#area1")
        .append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
          .append("g")
            .attr("transform", "translate(" 
                + margin.left 
                + "," + margin.top + ")");
    
    var stock = document.getElementById('stock').value;
    var start = document.getElementById('start').value;
    var end = document.getElementById('end').value;
        
    var randomCompany = Math.floor(Math.random() * 500 + 1);
    
    var inputURL = "https://query.yahooapis.com/v1/public/yql"+
        "?q=select%20*%20from%20yahoo.finance.historicaldata%20"+
        "where%20symbol%20%3D%20%22"
        +stock+"%22%20and%20startDate%20%3D%20%22"
        +start+"%22%20and%20endDate%20%3D%20%22"
        +end+"%22&format=json&env=store%3A%2F%2F"
        +"datatables.org%2Falltableswithkeys";
    
        // Get the data 
        d3.json(inputURL, function(error, data){
    
        data.query.results.quote.forEach(function(d) {
            d.date = parseDate(d.Date);
            d.high = +d.High;
            d.low = +d.Low;
        });
    
        // Scale the range of the data
        x.domain(d3.extent(data.query.results.quote, function(d) {
            return d.date; }));
        y.domain([
            d3.min(data.query.results.quote, function(d) { return d.low; }), 
            d3.max(data.query.results.quote, function(d) { return d.high; })
        ]);
    
        svg.append("path")        // Add the valueline path.
            .attr("class", "line")
            .attr("d", valueline(data.query.results.quote));
    
        svg.append("g")            // Add the X Axis
            .attr("class", "x axis")
            .attr("transform", "translate(0," + height + ")")
            .call(xAxis);
    
        svg.append("g")            // Add the Y Axis
            .attr("class", "y axis")
            .call(yAxis);
    
        svg.append("text")          // Add the label
            .attr("class", "label")
            .attr("transform", "translate(" + (width+3) + "," 
                + y(data.query.results.quote[0].high) + ")")
            .attr("dy", ".35em")
            .attr("text-anchor", "start")
            .style("fill", "steelblue")
            .text("high");
    
        svg.append("text")          // Add the title shadow
            .attr("x", (width / 2))
            .attr("y", margin.top / 2)
            .attr("text-anchor", "middle")
            .attr("class", "shadow")
            .style("font-size", "16px")
            .text(stock);
            
        svg.append("text")          // Add the title
            .attr("class", "stock")
            .attr("x", (width / 2))
            .attr("y", margin.top / 2)
            .attr("text-anchor", "middle")
            .style("font-size", "16px")
            .text(stock);
    });
    
    // ** Update data section (Called from the onclick)
    function updateData() {
    
    var stock = document.getElementById('stock').value;
    var start = document.getElementById('start').value;
    var end = document.getElementById('end').value;
    
    var inputURL = "https://query.yahooapis.com/v1/public/yql"+
        "?q=select%20*%20from%20yahoo.finance.historicaldata%20"+
        "where%20symbol%20%3D%20%22"
        +stock+"%22%20and%20startDate%20%3D%20%22"
        +start+"%22%20and%20endDate%20%3D%20%22"
        +end+"%22&format=json&env=store%3A%2F%2F"
        +"datatables.org%2Falltableswithkeys";
        // Get the data again
        d3.json(inputURL, function(error, data){
             console.log(data);
            data.query.results.quote.forEach(function(d) {
                d.date = parseDate(d.Date);
                d.high = +d.High;
                d.low = +d.Low;
            });
    
            // Scale the range of the data
            x.domain(d3.extent(data.query.results.quote, function(d) {
                return d.date; }));
            y.domain([
                d3.min(data.query.results.quote, function(d) { 
                    return d.low; }), 
                d3.max(data.query.results.quote, function(d) { 
                    return d.high; })
            ]);
    
            // Select the section we want to apply our changes to
            var svg = d3.select("#area1").transition();
    
            // Make the changes
            svg.select(".line")    // change the line
                .duration(750) 
                .attr("d", valueline(data.query.results.quote));
    
            svg.select(".label")   // change the label text
                .duration(750)
                .attr("transform", "translate(" + (width+3) + "," 
                + y(data.query.results.quote[0].high) + ")");
     
            svg.select(".shadow") // change the title shadow
                .duration(750)
                .text(stock);  
                 
            svg.select(".stock")   // change the title
                .duration(750)
                .text(stock);
         
            svg.select(".x.axis") // change the x axis
                .duration(750)
                .call(xAxis);
            svg.select(".y.axis") // change the y axis
                .duration(750)
                .call(yAxis);
    
        });
    }
    
    </script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js" charset="utf-8"></script>
    </body>
    <article>
        
        <h1 class="text-muted" >Test Your ability!</h1><br>
        
        <p><table class="table table-hover "
                <thead> <tr class="bg-faded"><th>Points</th><th>Description</th></tr></thead>
                <tbody><tr><td>20</td><td>Stuff STuf Stuasfsjdb</td></tr></tbody>
            </table>
        </p>
    </article>
</html>
